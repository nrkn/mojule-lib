var mojule=void 0===mojule?{}:mojule;
(function(){function m(a){return void 0!==a.value&&0<a.value.length?a.setter():a.getter()}function n(a,b,c){a.clone=function(){return new b(a)};a.toString=function(){return e(a).getPropertyValues(b.properties).join(",")};a.equals=function(){var d=e(arguments).toObject(b);return e(a).equals(d,b.properties)};a.almostEquals=function(){var d=e(arguments).toObject(b);return e(a).almostEquals(d,b.properties)};e(b.properties).each(function(d){a[d]=0});b.mapper.map(a,c);e.addMath(a,b.properties)}function p(a,
b){var c={args:{predicate:function(a){return a instanceof Array&&1<a.length&&e(a).allOfType("number")},map:function(d,c){e(a.properties).each(function(a,b){c[a]=d.length>b?parseFloat(d[b]):c[a]});return c}},str:{predicate:function(a){return"string"===typeof a&&0<a.match(r).length},map:function(d,c){var b=d.match(r);e(a.properties).each(function(a,d){c[a]=b.length>d?parseFloat(b[d]):c[a]});return c}}};e(b).each(function(d,b){var f;if(void 0!==d.aliases){var h=d.aliases;f=function(d){var c=[];e(a.properties).each(function(a){c.push(d[a]);
void 0!==h[a]&&c.push(d[h[a]])});return e(c).anyDefined()}}else f=e([d.properties,d.map]).allDefined()?function(a){return void 0!==e(a).hasAllProperties&&e(a).hasAllProperties(d.properties)}:void 0!==d.copy?function(a){return void 0!==e(a).hasAllProperties&&e(a).hasAllProperties(d.copy)}:function(){return!1};var i;if(void 0!==d.aliases){var k=d.aliases;i=function(d,c){e(a.properties).each(function(a){var b=[d[a]];void 0!==k&&void 0!==k[a]&&b.push(d[k[a]]);b.push(c[a]);c[a]=parseFloat(e(b).firstDefined())});
return c}}else i=e([d.properties,d.map]).allDefined()?function(a,c){d.map(a,c);return c}:void 0!==d.copy?function(a,c){e(d.copy).each(function(d){c[d]=a[d]});return c}:function(a,d){return d};c[b]={predicate:f,map:i}});return c}function s(a,b,c,d,q){var f=Math.min(b,d),e=Math.min(c,q);a.left=f;a.top=e;a.width=Math.max(b,d)-f;a.height=Math.max(c,q)-e}var g=mojule.Extensions=function(a){var b={Number:{clamp:function(c,d){return a<c?c:a>d?d:a},wrap:function(c){return(a%c+c)%c},toRadians:function(){return g(a).wrap(360)/
180*Math.PI},difference:function(c){return Math.abs(c-a)},step:function(c){return a<c?1:c<a?-1:0},toFixed:function(c){return parseFloat(a.toFixed(c))},almostEquals:function(c,d){return g(a).toFixed(d)===g(c).toFixed(d)},each:function(c){for(var d=0;d<a;d++)c(d,a)}},String:{trim:function(){return String.prototype.trim?a.trim():a.replace(/^\s\s*/,"").replace(/\s\s*$/,"")},inject:function(c){var d=a;g(c).each(function(a,c){for(var b="{"+c+"}";d.match(b);)d=d.replace(b,a)});return d}},Array:{first:function(c){if(!c)return a[0];
for(var d=0;d<a.length;d++)if(c(a[d]))return a[d]},any:function(c){if(Array.prototype.some)return a.some(c);if(!c)return!1;g(a).each(function(a){if(c(a))return!0});return!1},all:function(c){if(Array.prototype.every)return a.every(c);if(!c)return!1;g(a).each(function(a){if(!c(a))return!1});return!0},allOfType:function(c){return g(a).all(function(a){return typeof a===c})},firstDefined:function(){return g(a).first(function(a){return void 0!==a})},anyDefined:function(){return g(a).any(function(a){return void 0!==
a})},allDefined:function(){return g(a).all(function(a){return void 0!==a})},elementsEqual:function(c){if(a.length!==c.length)return!1;for(var d=0;d<c.length;d++){if(g(a[d]).elementsEqual)if(g(a[d]).elementsEqual(c[d]))continue;else return!1;if(void 0!==a[d].equals&&"function"===typeof a[d].equals){if(!a[d].equals(c[d]))return!1}else if(a[d]!==c[d])return!1}return!0},min:function(){return Math.min.apply(Math,a)},max:function(){return Math.max.apply(Math,a)},count:function(c){if(void 0===c)return a.length;
var d=0;g(a).each(function(a){c(a)&&d++});return d},each:function(c){for(var d=0;d<a.length;d++)c(a[d],d,a)},chunk:function(c){return[].concat.apply([],a.map(function(d,b){return b%c?[]:[a.slice(b,b+c)]}))}},Arguments:{toValue:function(){return 0===a.length?void 0:1<a.length?Array.prototype.slice.call(a):a[0]},toObject:function(c){return new c(g(a).toValue())}}}[g.getClass(a)];return void 0!==b?b:{equals:function(c,d){for(var b=0;b<d.length;b++)if(a[d[b]]!==c[d[b]])return!1;return!0},almostEquals:function(b,
d){for(var e=0;e<d.length;e++)if(!g(a[d[e]]).almostEquals(b[d[e]],4))return!1;return!0},getPropertyValues:function(b){return b.map(function(d){return a[d]})},each:function(b){for(var d in a)a.hasOwnProperty(d)&&b(a[d],d,a)},injectToString:function(b){return g(b).inject(a)},hasAllProperties:function(b){return g(b).all(function(b){return void 0!==a[b]})}}};void 0===Function.prototype.name&&void 0!==Object.defineProperty&&Object.defineProperty(Function.prototype,"name",{get:function(){var a=/function\s+(.{1,})\s*\(/.exec(this.toString());
return a&&1<a.length?a[1]:""},set:function(){}});g.getClass=function(a){var b=Object.prototype.toString.call(a).match(/^\[object\s(.*)\]$/)[1];return"Object"===b&&"Object"!==a.constructor.name?a.constructor.name:b};g.addMath=function(a,b){g.mixin(Math,a,"abs acos asin atan atan2 ceil cos exp floor log round sin sqrt tan".split(" "),b)};g.mixin=function(a,b,c,d){for(var e=function(c){b[c]=function(){for(var e=0;e<d.length;e++){var f=d[e];b[f]=a[c].apply(a,[b[f]])}return b}},f=0;f<c.length;f++)e(c[f])};
var l=mojule.Extensions;mojule.Mapper=function(a){var b=this,c={undefinedValue:{predicate:function(a){return void 0===a||null===a},map:function(a,b){return b}},toArray:function(){var a=[],b;for(b in this)this.hasOwnProperty(b)&&"function"!==typeof this[b]&&a.push({name:b,predicate:this[b].predicate,map:this[b].map});return a}};this.map=function(a,b){var e=l(b).toValue(),g=l(c.toArray()).first(function(a){return a.predicate(e)});return!g?void 0:g.map(e,a)};this.hasMapping=function(a){return l(c.toArray()).any(function(b){return b.predicate(a)})};
this.getMappingName=function(a){var b=l(c.toArray()).first(function(b){return b.predicate(a)});if(void 0!==b)return b.name};this.addMapping=function(a,b){c[a]=b};this.addMappings=function(a){l(a).each(function(a,c){"function"!==typeof a&&b.addMapping(c,{predicate:a.predicate,map:a.map})})};this.removeMapping=function(a){void 0!==c[a]&&delete c[a]};void 0!==a&&(a instanceof Array?l(a).each(function(a){b.addMappings(a)}):b.addMappings(a))};var e=mojule.Extensions,r=/[+\-]?(?:\d+\.?\d*|\d*\.?\d+)/g;
mojule.Point=function(){var a=this;n(a,mojule.Point,arguments);this.unitVector=function(){return new Point(a.x/a.length(),a.y/a.length())};this.length=function(){return m({value:arguments,setter:function(){var b=a.unitVector(),c=e(this.value).toValue();a.x=b.x*c;a.y=b.y*c;return a},getter:function(){return Math.sqrt(a.x*a.x+a.y*a.y)}})};this.scale=function(b){a.x*=b;a.y*=b;return a};this.translate=function(){var b=e(arguments).toObject(mojule.Point);a.x+=b.x;a.y+=b.y;return a};this.rotate=function(){if(1>
arguments.length)return a;var b=arguments[0],c=1<arguments.length?e(arguments).toValue().slice(1):void 0,d=e(parseFloat(b)).toRadians();void 0!==c&&(c=new mojule.Point(c),a.translate(new mojule.Point(-1*c.x,-1*c.y)));b=a.x*Math.cos(d)-a.y*Math.sin(d);d=a.x*Math.sin(d)+a.y*Math.cos(d);a.x=b;a.y=d;void 0!==c&&a.translate(c);return a};this.lineTo=function(){var b=e(arguments).toObject(mojule.Point);return new mojule.Line(a,b)};this.lineFrom=function(){var b=e(arguments).toObject(mojule.Point);return new mojule.Line(b,
a)};this.neighbours=function(){return[new mojule.Point(a.x,a.y-1),new mojule.Point(a.x,a.y+1),new mojule.Point(a.x-1,a.y),new mojule.Point(a.x+1,a.y)]};this.wrap=function(){var b=new mojule.Size(arguments);a.x=e(a.x).wrap(b.width);a.y=e(a.y).wrap(b.height);return a}};mojule.Point.properties=["x","y"];mojule.Point.mapper=new mojule.Mapper(p(mojule.Point,{line:{properties:["x1","y1","x2","y2"],map:function(a,b){b.x=Math.max(a.x1,a.x2)-Math.min(a.x1,a.x2);b.y=Math.max(a.y1,a.y2)-Math.min(a.y1,a.y2)}},
rectangleOrSize:{aliases:{x:"width",y:"height"}},rectangle2:{properties:["left","top","right","bottom"],map:function(a,b){b.x=Math.max(a.left,a.right)-Math.min(a.left,a.right);b.y=Math.max(a.top,a.bottom)-Math.min(a.top,a.bottom)}},leftTop:{aliases:{x:"left",y:"top"}}}));mojule.Line=function(){var a=this;n(a,mojule.Line,arguments);this.start=function(){return m({value:arguments,setter:function(){var b=e(this.value).toObject(mojule.Point);a.x1=b.x;a.y1=b.y;return a},getter:function(){return new mojule.Point(a.x1,
a.y1)}})};this.end=function(){return m({value:arguments,setter:function(){var b=e(this.value).toObject(mojule.Point);a.x2=b.x;a.y2=b.y;return a},getter:function(){return new mojule.Point(a.x2,a.y2)}})};this.verticals=function(){return[a.x1,a.x2]};this.horizontals=function(){return[a.y1,a.y2]};this.points=function(){return[a.start(),a.end()]};this.bresenham=function(){for(var b=a.clone().round(),c=e(b.end().x).difference(b.start().x),d=e(b.end().y).difference(b.start().y),g=e(b.start().x).step(b.end().x),
f=e(b.start().y).step(b.end().y),h=c-d,i=b.start(),k=[];;){k.push(i.clone());if(i.equals(b.end()))break;var j=2*h;j>-d&&(h-=d,i.x+=g);j>=c||(h+=c,i.y+=f)}return k};this.rotate=function(){a.start(a.start.rotate(arguments));a.end(a.end.rotate(arguments));return a};this.translate=function(){var b=e(arguments).toObject(mojule.Point);a.start(a.start().translate(b));a.end(a.end().translate(b));return a}};mojule.Line.properties=["x1","y1","x2","y2"];mojule.Line.mapper=new mojule.Mapper([p(mojule.Line,{point:{aliases:{x2:"x",
y2:"y"}},sizeOrRectangle:{properties:["width","height"],map:function(a,b){var c=void 0!==a.x?a.x:0,d=void 0!==a.y?a.y:0;b.x1=c;b.y1=d;b.x2=c+a.width;b.y2=d+a.height}}}),{points:{predicate:function(a){return a instanceof Array&&1<a.length&&e([a[0].x,a[0].y]).anyDefined()&&e([a[1].x,a[1].y]).anyDefined()},map:function(a,b){b.x1=parseFloat(a[0].x);b.y1=parseFloat(a[0].y);b.x2=parseFloat(a[1].x);b.y2=parseFloat(a[1].y);return b}}}]);mojule.Size=function(){n(this,mojule.Size,arguments)};mojule.Size.properties=
["width","height"];mojule.Size.mapper=new mojule.Mapper([p(mojule.Size,{point:{aliases:{width:"x",height:"y"}},line:{properties:["x1","y1","x2","y2"],map:function(a,b){b.width=Math.max(a.x1,a.x2)-Math.min(a.x1,a.x2);b.height=Math.max(a.y1,a.y2)-Math.min(a.y1,a.y2)}},rectangle:{copy:["width","height"]},rectangle2:{properties:["left","right","top","bottom"],map:function(a,b){b.width=Math.max(a.left,a.right)-Math.min(a.left,a.right);b.height=Math.max(a.top,a.bottom)-Math.min(a.top,a.bottom)}}})]);mojule.Rectangle=
function(){var a=this;n(a,mojule.Rectangle,arguments);this.right=function(){return a.left+a.width};this.bottom=function(){return a.top+a.height};this.inBounds=function(){var b=new mojule.Point(e(arguments).toValue());return b.x>=a.left&&b.x<=a.right()&&b.y>=top&&b.y<=a.bottom()}};mojule.Rectangle.properties=["left","top","width","height"];mojule.Rectangle.mapper=new mojule.Mapper([p(mojule.Rectangle,{rectangle3:{properties:["x","y","width","height"],map:function(a,b){b.width=a.width;b.height=a.height}},
point:{aliases:{left:"x",top:"y"}},line:{properties:["x1","y1","x2","y2"],map:function(a,b){s(b,a.x1,a.y1,a.x2,a.y2)}},size:{copy:["width","height"]},rectangle2:{properties:["left","right","top","bottom"],map:function(a,b){s(b,a.left,a.top,a.right,a.bottom)}}})]);mojule.Grid=function(){function a(a,e,j){c[e*f.width+a]=j;void 0===d[e]&&(d[e]=[]);d[e][a]=j;void 0===g[a]&&(g[a]=[]);g[a][e]=j;return b}var b=this,c=[],d=[],g=[],f=new mojule.Size;this.get=function(){if(1<arguments.length&&"number"===typeof arguments[0]&&
"number"===typeof arguments[1])return c[arguments[1]*f.width+arguments[0]];if(1===arguments.length&&void 0!==arguments[0].x&&void 0!==arguments[0].y)return c[arguments[0].y*f.width+arguments[0].x];var a=new mojule.Point(arguments);return c[a.y*f.width+a.x]};this.set=function(){if(!(2>arguments.length)){var b=arguments[0];if(2<arguments.length&&"number"===typeof arguments[1]&&"number"===typeof arguments[2])return a(b,arguments[1],arguments[2]);if(2===arguments.length&&void 0!==arguments[1].x&&void 0!==
arguments[1].y)return a(b,arguments[1].x,arguments[1].y);var c=new mojule.Point(e(arguments).toValue().slice(1));return a(b,c.x,c.y)}};this.each=function(a){for(var d=0;d<f.height;d++)for(var e=0;e<f.width;e++)a(c[d*f.width+e],e,d,f.width,f.height);return b};this.setEach=function(d){for(var e=0;e<f.height;e++)for(var g=0;g<f.width;g++)a(g,e,d(g,e,c[e*f.width+g],f.width,f.height));return b};this.cells=function(){return m({value:arguments,setter:function(){c=e(this.value).toValue();g=[];for(var a=0;a<
f.width;a++){for(var h=[],j=0;j<f.height;j++)h.push(c[j*f.width+a]);g.push(h)}d=e(b.cells()).chunk(f.width);return b},getter:function(){return c.slice(0)}})};this.size=function(){return f.clone()};this.clone=function(){var a=new Grid(f);a.cells(b.cells());return a};this.toString=function(a){return void 0!==a&&a instanceof Function?f.toString()+","+c.map(a).join(","):f.toString()+","+JSON.stringify(c)};this.equals=function(a){return f.equals(a.size())&&e(c).elementsEqual(a.cells())};this.bounds=function(){return new Rectangle(f)};
this.rows=function(){return d.slice(0)};this.columns=function(){return g.slice(0)};var h=e(arguments).toValue();null!==h&&e([h.width,h.height,h.data]).allDefined()?(f=new mojule.Size(h.width,h.height),c=e(h.data).chunk(4)):(mojule.Size.mapper.map(f,arguments),f.ceil().abs())}})();var Point=void 0===Point?mojule.Point:Point,Line=void 0===Line?mojule.Line:Line,Size=void 0===Size?mojule.Size:Size,Rectangle=void 0===Rectangle?mojule.Rectangle:Rectangle,Grid=void 0===Grid?mojule.Grid:Grid;