var mojule=void 0===mojule?{}:mojule;
(function(){function l(a){return void 0!==a.value&&0<a.value.length?a.setter():a.getter()}function m(a,b,d){a.clone=function(){return new b(a)};a.toString=function(){return c(a).getPropertyValues(b.properties).join(",")};a.equals=function(){var f=c(arguments).toObject(b);return c(a).equals(f,b.properties)};a.almostEquals=function(){var f=c(arguments).toObject(b);return c(a).almostEquals(f,b.properties)};c(b.properties).each(function(b){a[b]=0});b.mapper.map(a,d);c.addMath(a,b.properties)}function n(a,
b){var d={args:{predicate:function(a){return a instanceof Array&&1<a.length&&c(a).allOfType("number")},map:function(b,d){c(a.properties).each(function(a,c){d[a]=b.length>c?parseFloat(b[c]):d[a]});return d}},str:{predicate:function(a){return"string"===typeof a&&0<a.match(o).length},map:function(b,d){var e=b.match(o);c(a.properties).each(function(a,b){d[a]=e.length>b?parseFloat(e[b]):d[a]});return d}}};c(b).each(function(b,j){var e;if(void 0!==b.aliases){var g=b.aliases;e=function(b){var d=[];c(a.properties).each(function(a){d.push(b[a]);
void 0!==g[a]&&d.push(b[g[a]])});return c(d).anyDefined()}}else e=c([b.properties,b.map]).allDefined()?function(a){return void 0!==c(a).hasAllProperties&&c(a).hasAllProperties(b.properties)}:void 0!==b.copy?function(a){return void 0!==c(a).hasAllProperties&&c(a).hasAllProperties(b.copy)}:function(){return!1};var i;if(void 0!==b.aliases){var k=b.aliases;i=function(b,d){c(a.properties).each(function(a){var i=[b[a]];void 0!==k&&void 0!==k[a]&&i.push(b[k[a]]);i.push(d[a]);d[a]=parseFloat(c(i).firstDefined())});
return d}}else i=c([b.properties,b.map]).allDefined()?function(a,d){b.map(a,d);return d}:void 0!==b.copy?function(a,d){c(b.copy).each(function(b){d[b]=a[b]});return d}:function(a,b){return b};d[j]={predicate:e,map:i}});return d}function p(a,b,d,c,j){var e=Math.min(b,c),g=Math.min(d,j);a.left=e;a.top=g;a.width=Math.max(b,c)-e;a.height=Math.max(d,j)-g}var c=mojule.Extensions,o=/[+\-]?(?:\d+\.?\d*|\d*\.?\d+)/g;mojule.Point=function(){var a=this;m(a,mojule.Point,arguments);this.unitVector=function(){return new Point(a.x/
a.length(),a.y/a.length())};this.length=function(){return l({value:arguments,setter:function(){var b=a.unitVector(),d=c(this.value).toValue();a.x=b.x*d;a.y=b.y*d;return a},getter:function(){return Math.sqrt(a.x*a.x+a.y*a.y)}})};this.scale=function(b){a.x*=b;a.y*=b;return a};this.translate=function(){var b=c(arguments).toObject(mojule.Point);a.x+=b.x;a.y+=b.y;return a};this.rotate=function(){if(1>arguments.length)return a;var b=arguments[0],d=1<arguments.length?c(arguments).toValue().slice(1):void 0,
f=c(parseFloat(b)).toRadians();void 0!==d&&(d=new mojule.Point(d),a.translate(new mojule.Point(-1*d.x,-1*d.y)));b=a.x*Math.cos(f)-a.y*Math.sin(f);f=a.x*Math.sin(f)+a.y*Math.cos(f);a.x=b;a.y=f;void 0!==d&&a.translate(d);return a};this.lineTo=function(){var b=c(arguments).toObject(mojule.Point);return new mojule.Line(a,b)};this.lineFrom=function(){var b=c(arguments).toObject(mojule.Point);return new mojule.Line(b,a)};this.neighbours=function(){return[new mojule.Point(a.x,a.y-1),new mojule.Point(a.x,
a.y+1),new mojule.Point(a.x-1,a.y),new mojule.Point(a.x+1,a.y)]};this.wrap=function(){var b=new mojule.Size(arguments);a.x=c(a.x).wrap(b.width);a.y=c(a.y).wrap(b.height);return a}};mojule.Point.properties=["x","y"];mojule.Point.mapper=new mojule.Mapper(n(mojule.Point,{line:{properties:["x1","y1","x2","y2"],map:function(a,b){b.x=Math.max(a.x1,a.x2)-Math.min(a.x1,a.x2);b.y=Math.max(a.y1,a.y2)-Math.min(a.y1,a.y2)}},rectangleOrSize:{aliases:{x:"width",y:"height"}},rectangle2:{properties:["left","top",
"right","bottom"],map:function(a,b){b.x=Math.max(a.left,a.right)-Math.min(a.left,a.right);b.y=Math.max(a.top,a.bottom)-Math.min(a.top,a.bottom)}},leftTop:{aliases:{x:"left",y:"top"}}}));mojule.Line=function(){var a=this;m(a,mojule.Line,arguments);this.start=function(){return l({value:arguments,setter:function(){var b=c(this.value).toObject(mojule.Point);a.x1=b.x;a.y1=b.y;return a},getter:function(){return new mojule.Point(a.x1,a.y1)}})};this.end=function(){return l({value:arguments,setter:function(){var b=
c(this.value).toObject(mojule.Point);a.x2=b.x;a.y2=b.y;return a},getter:function(){return new mojule.Point(a.x2,a.y2)}})};this.verticals=function(){return[a.x1,a.x2]};this.horizontals=function(){return[a.y1,a.y2]};this.points=function(){return[a.start(),a.end()]};this.bresenham=function(){for(var b=a.clone().round(),d=c(b.end().x).difference(b.start().x),f=c(b.end().y).difference(b.start().y),j=c(b.start().x).step(b.end().x),e=c(b.start().y).step(b.end().y),g=d-f,i=b.start(),k=[];;){k.push(i.clone());
if(i.equals(b.end()))break;var h=2*g;h>-f&&(g-=f,i.x+=j);h>=d||(g+=d,i.y+=e)}return k};this.rotate=function(){a.start(a.start.rotate(arguments));a.end(a.end.rotate(arguments));return a};this.translate=function(){var b=c(arguments).toObject(mojule.Point);a.start(a.start().translate(b));a.end(a.end().translate(b));return a}};mojule.Line.properties=["x1","y1","x2","y2"];mojule.Line.mapper=new mojule.Mapper([n(mojule.Line,{point:{aliases:{x2:"x",y2:"y"}},sizeOrRectangle:{properties:["width","height"],
map:function(a,b){var d=void 0!==a.x?a.x:0,c=void 0!==a.y?a.y:0;b.x1=d;b.y1=c;b.x2=d+a.width;b.y2=c+a.height}}}),{points:{predicate:function(a){return a instanceof Array&&1<a.length&&c([a[0].x,a[0].y]).anyDefined()&&c([a[1].x,a[1].y]).anyDefined()},map:function(a,b){b.x1=parseFloat(a[0].x);b.y1=parseFloat(a[0].y);b.x2=parseFloat(a[1].x);b.y2=parseFloat(a[1].y);return b}}}]);mojule.Size=function(){m(this,mojule.Size,arguments)};mojule.Size.properties=["width","height"];mojule.Size.mapper=new mojule.Mapper([n(mojule.Size,
{point:{aliases:{width:"x",height:"y"}},line:{properties:["x1","y1","x2","y2"],map:function(a,b){b.width=Math.max(a.x1,a.x2)-Math.min(a.x1,a.x2);b.height=Math.max(a.y1,a.y2)-Math.min(a.y1,a.y2)}},rectangle:{copy:["width","height"]},rectangle2:{properties:["left","right","top","bottom"],map:function(a,b){b.width=Math.max(a.left,a.right)-Math.min(a.left,a.right);b.height=Math.max(a.top,a.bottom)-Math.min(a.top,a.bottom)}}})]);mojule.Rectangle=function(){var a=this;m(a,mojule.Rectangle,arguments);this.right=
function(){return a.left+a.width};this.bottom=function(){return a.top+a.height};this.inBounds=function(){var b=new mojule.Point(c(arguments).toValue());return b.x>=a.left&&b.x<=a.right()&&b.y>=top&&b.y<=a.bottom()}};mojule.Rectangle.properties=["left","top","width","height"];mojule.Rectangle.mapper=new mojule.Mapper([n(mojule.Rectangle,{rectangle3:{properties:["x","y","width","height"],map:function(a,b){b.width=a.width;b.height=a.height}},point:{aliases:{left:"x",top:"y"}},line:{properties:["x1",
"y1","x2","y2"],map:function(a,b){p(b,a.x1,a.y1,a.x2,a.y2)}},size:{copy:["width","height"]},rectangle2:{properties:["left","right","top","bottom"],map:function(a,b){p(b,a.left,a.top,a.right,a.bottom)}}})]);mojule.Grid=function(){function a(a,c,h){d[c*e.width+a]=h;void 0===f[c]&&(f[c]=[]);f[c][a]=h;void 0===j[a]&&(j[a]=[]);j[a][c]=h;return b}var b=this,d=[],f=[],j=[],e=new mojule.Size;this.get=function(){if(1<arguments.length&&"number"===typeof arguments[0]&&"number"===typeof arguments[1])return d[arguments[1]*
e.width+arguments[0]];if(1===arguments.length&&void 0!==arguments[0].x&&void 0!==arguments[0].y)return d[arguments[0].y*e.width+arguments[0].x];var a=new mojule.Point(arguments);return d[a.y*e.width+a.x]};this.set=function(){if(!(2>arguments.length)){var b=arguments[0];if(2<arguments.length&&"number"===typeof arguments[1]&&"number"===typeof arguments[2])return a(b,arguments[1],arguments[2]);if(2===arguments.length&&void 0!==arguments[1].x&&void 0!==arguments[1].y)return a(b,arguments[1].x,arguments[1].y);
var d=new mojule.Point(c(arguments).toValue().slice(1));return a(b,d.x,d.y)}};this.each=function(a){for(var c=0;c<e.height;c++)for(var h=0;h<e.width;h++)a(d[c*e.width+h],h,c,e.width,e.height);return b};this.setEach=function(c){for(var f=0;f<e.height;f++)for(var h=0;h<e.width;h++)a(h,f,c(h,f,d[f*e.width+h],e.width,e.height));return b};this.cells=function(){return l({value:arguments,setter:function(){d=c(this.value).toValue();j=[];for(var a=0;a<e.width;a++){for(var g=[],h=0;h<e.height;h++)g.push(d[h*
e.width+a]);j.push(g)}f=c(b.cells()).chunk(e.width);return b},getter:function(){return d.slice(0)}})};this.size=function(){return e.clone()};this.clone=function(){var a=new Grid(e);a.cells(b.cells());return a};this.toString=function(a){return void 0!==a&&a instanceof Function?e.toString()+","+d.map(a).join(","):e.toString()+","+JSON.stringify(d)};this.equals=function(a){return e.equals(a.size())&&c(d).elementsEqual(a.cells())};this.bounds=function(){return new Rectangle(e)};this.rows=function(){return f.slice(0)};
this.columns=function(){return j.slice(0)};var g=c(arguments).toValue();null!==g&&c([g.width,g.height,g.data]).allDefined()?(e=new mojule.Size(g.width,g.height),d=c(g.data).chunk(4)):(mojule.Size.mapper.map(e,arguments),e.ceil().abs())}})();var Point=void 0===Point?mojule.Point:Point,Line=void 0===Line?mojule.Line:Line,Size=void 0===Size?mojule.Size:Size,Rectangle=void 0===Rectangle?mojule.Rectangle:Rectangle,Grid=void 0===Grid?mojule.Grid:Grid;